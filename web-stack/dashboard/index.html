<html>
    <head>
        <title>Monitoring Dashboard</title>
        <script>
            const API_URL = "http://localhost:8000";
            const RELOAD_INTERVAL = 500 // ms

            const fetchtest = async () => {
                const res = await fetch(API_URL);
                const response_text = await res.json();
                data = JSON.parse(response_text);
                print_rows(data);
            }

            const print_rows = (data) => {
                const dashboard_div = document.getElementById("rows");
                dashboard_div.innerHTML = '';

                data.forEach((item, index) => {
                    const p = document.createElement("p");
                    p.textContent = JSON.stringify(item);
                    dashboard_div.appendChild(p);
                });
            }

            const mainloop = async () => {
                while (true) {
                    try {
                        await fetchtest();
                    } catch (err) {
                        console.error(err);
                        break;
                    }
                    await new Promise(resolve => setTimeout(resolve, RELOAD_INTERVAL));
                }
            }

            mainloop();
        </script>
    </head>
    <body>
        <h1>Dashboard</h1>
        <button onclick="fetchtest()">Click me!</button>
        <div id="rows"></div>
    </body>
</html>